<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Claude Code SDK Playground</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Neue:wght@400;700&family=Fira+Code:wght@400;600&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --purple: #7c3aed;
    --purple-light: #a78bfa;
    --purple-dark: #5b21b6;
    --pink: #ec4899;
    --yellow: #fbbf24;
    --green: #34d399;
    --green-dark: #059669;
    --red: #f87171;
    --red-dark: #dc2626;
    --blue: #60a5fa;
    --blue-dark: #3b82f6;
    --orange: #fb923c;
    --orange-dark: #ea580c;
    --teal: #2dd4bf;
    --teal-dark: #0d9488;
    --bg: #f0e6ff;
    --card-bg: #ffffff;
    --terminal-bg: #1e1b2e;
    --terminal-text: #e2e8f0;
  }

  body {
    font-family: 'Comic Neue', cursive, sans-serif;
    background: var(--bg);
    background-image:
      radial-gradient(circle at 10% 20%, rgba(124,58,237,0.1) 0%, transparent 50%),
      radial-gradient(circle at 90% 80%, rgba(236,72,153,0.08) 0%, transparent 50%),
      radial-gradient(circle at 50% 50%, rgba(45,212,191,0.06) 0%, transparent 60%);
    min-height: 100vh;
    color: #1e1b4b;
    overflow-x: hidden;
  }

  .blob {
    position: fixed;
    border-radius: 50%;
    opacity: 0.12;
    z-index: 0;
    animation: blobFloat 8s ease-in-out infinite alternate;
    pointer-events: none;
  }
  .blob-1 { width: 300px; height: 300px; background: var(--purple); top: -80px; left: -60px; }
  .blob-2 { width: 200px; height: 200px; background: var(--teal); bottom: 10%; right: -40px; animation-delay: -3s; }
  .blob-3 { width: 250px; height: 250px; background: var(--pink); top: 40%; left: 70%; animation-delay: -5s; }

  @keyframes blobFloat {
    to { transform: translate(30px, 20px) scale(1.08); }
  }

  header {
    text-align: center;
    padding: 50px 20px 30px;
    position: relative;
    z-index: 1;
  }
  header h1 {
    font-family: 'Fredoka One', cursive;
    font-size: clamp(2.2rem, 5.5vw, 3.6rem);
    background: linear-gradient(135deg, var(--purple), var(--teal));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(2px 4px 0 rgba(124,58,237,0.18));
    margin-bottom: 8px;
  }
  header .mascot {
    font-size: 3.6rem;
    animation: bounce 1.6s ease-in-out infinite;
    display: inline-block;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
  }
  header p {
    font-size: 1.15rem;
    color: #6b7280;
    max-width: 600px;
    margin: 0 auto;
    line-height: 1.6;
  }

  .container {
    max-width: 920px;
    margin: 0 auto;
    padding: 0 20px 60px;
    position: relative;
    z-index: 1;
  }

  .card {
    background: var(--card-bg);
    border-radius: 24px;
    padding: 32px;
    margin-bottom: 28px;
    box-shadow: 0 4px 24px rgba(124,58,237,0.08), 0 1px 3px rgba(0,0,0,0.06);
    border: 2.5px solid transparent;
    transition: border-color 0.3s, transform 0.2s;
    position: relative;
    overflow: hidden;
  }
  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 5px;
    border-radius: 24px 24px 0 0;
  }
  .card:hover { transform: translateY(-2px); }
  .card.purple::before { background: linear-gradient(90deg, var(--purple), var(--purple-light)); }
  .card.pink::before   { background: linear-gradient(90deg, var(--pink), #f9a8d4); }
  .card.green::before  { background: linear-gradient(90deg, var(--green-dark), var(--green)); }
  .card.blue::before   { background: linear-gradient(90deg, var(--blue-dark), var(--blue)); }
  .card.orange::before { background: linear-gradient(90deg, var(--orange-dark), var(--orange)); }
  .card.red::before    { background: linear-gradient(90deg, var(--red-dark), var(--red)); }
  .card.teal::before   { background: linear-gradient(90deg, var(--teal-dark), var(--teal)); }

  .card h2 {
    font-family: 'Fredoka One', cursive;
    font-size: 1.55rem;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .card h2 .icon { font-size: 1.7rem; }
  .card .desc {
    color: #6b7280;
    margin-bottom: 18px;
    line-height: 1.55;
  }
  .card .desc code {
    background: #f3f0ff;
    padding: 2px 7px;
    border-radius: 6px;
    font-family: 'Fira Code', monospace;
    font-size: 0.88em;
    color: var(--purple-dark);
  }

  .terminal {
    background: var(--terminal-bg);
    border-radius: 14px;
    overflow: hidden;
    margin: 14px 0;
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.25);
  }
  .terminal-bar {
    background: #2d2640;
    padding: 8px 14px;
    display: flex;
    align-items: center;
    gap: 7px;
  }
  .terminal-dot {
    width: 11px; height: 11px;
    border-radius: 50%;
  }
  .terminal-dot.r { background: #f87171; }
  .terminal-dot.y { background: #fbbf24; }
  .terminal-dot.g { background: #34d399; }
  .terminal-bar span {
    color: #a78bfa;
    font-family: 'Fira Code', monospace;
    font-size: 0.78rem;
    margin-left: 8px;
  }
  .terminal-body {
    padding: 16px 18px;
    font-family: 'Fira Code', monospace;
    font-size: 0.85rem;
    color: var(--terminal-text);
    min-height: 50px;
    max-height: 420px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-all;
    line-height: 1.6;
  }
  .terminal-body::-webkit-scrollbar { width: 6px; }
  .terminal-body::-webkit-scrollbar-thumb { background: #4c3f78; border-radius: 3px; }

  .prompt { color: var(--green); }
  .cmd { color: #f1f5f9; }
  .out { color: #cbd5e1; }
  .ok { color: #34d399; }
  .err { color: #f87171; }
  .info { color: #60a5fa; }
  .path { color: #fbbf24; }
  .dim { color: #64748b; }
  .kw { color: #c084fc; }
  .str { color: #34d399; }
  .fn { color: #60a5fa; }
  .type { color: #2dd4bf; }
  .comment { color: #64748b; font-style: italic; }
  .num { color: #fbbf24; }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 11px 22px;
    border-radius: 50px;
    border: none;
    font-family: 'Comic Neue', cursive;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 3px 0 rgba(0,0,0,0.15);
    position: relative;
    top: 0;
  }
  .btn:active {
    top: 3px;
    box-shadow: 0 0 0 rgba(0,0,0,0.15);
  }
  .btn:disabled {
    opacity: 0.55;
    cursor: not-allowed;
  }
  .btn-purple { background: var(--purple); color: #fff; }
  .btn-purple:hover:not(:disabled) { background: var(--purple-dark); }
  .btn-pink { background: var(--pink); color: #fff; }
  .btn-pink:hover:not(:disabled) { background: #db2777; }
  .btn-green { background: var(--green-dark); color: #fff; }
  .btn-green:hover:not(:disabled) { background: #047857; }
  .btn-red { background: var(--red-dark); color: #fff; }
  .btn-red:hover:not(:disabled) { background: #b91c1c; }
  .btn-blue { background: var(--blue-dark); color: #fff; }
  .btn-blue:hover:not(:disabled) { background: #2563eb; }
  .btn-orange { background: var(--orange-dark); color: #fff; }
  .btn-orange:hover:not(:disabled) { background: #c2410c; }
  .btn-teal { background: var(--teal-dark); color: #fff; }
  .btn-teal:hover:not(:disabled) { background: #0f766e; }
  .btn-outline {
    background: transparent;
    border: 2.5px solid var(--purple);
    color: var(--purple);
    box-shadow: none;
  }
  .btn-outline:hover:not(:disabled) { background: rgba(124,58,237,0.08); }

  .btn-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 14px;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 14px;
    border-radius: 50px;
    font-size: 0.82rem;
    font-weight: 700;
  }
  .badge-success { background: #d1fae5; color: #047857; }
  .badge-info { background: #dbeafe; color: #1d4ed8; }

  .progress-wrap {
    background: #e5e7eb;
    border-radius: 50px;
    height: 22px;
    overflow: hidden;
    margin: 12px 0;
  }
  .progress-bar {
    height: 100%;
    border-radius: 50px;
    background: linear-gradient(90deg, var(--purple), var(--teal));
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    font-size: 0.72rem;
    font-weight: 700;
    color: #fff;
    min-width: 36px;
  }

  #confetti-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 9999;
  }

  .score-display {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #f8f5ff, #e0f2fe);
    border-radius: 18px;
    margin: 14px 0;
  }
  .score-num {
    font-family: 'Fredoka One', cursive;
    font-size: 3rem;
    background: linear-gradient(135deg, var(--purple), var(--teal));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .score-label { color: #6b7280; font-size: 0.9rem; }

  /* code block inside cards */
  .code-block {
    background: var(--terminal-bg);
    border-radius: 14px;
    overflow: hidden;
    margin: 14px 0;
  }
  .code-bar {
    background: #2d2640;
    padding: 8px 14px;
    display: flex;
    align-items: center;
    justify-content: space-between;
  }
  .code-bar .dots {
    display: flex;
    gap: 7px;
  }
  .code-bar .lang {
    color: #a78bfa;
    font-family: 'Fira Code', monospace;
    font-size: 0.78rem;
  }
  .code-body {
    padding: 16px 18px;
    font-family: 'Fira Code', monospace;
    font-size: 0.82rem;
    color: var(--terminal-text);
    line-height: 1.7;
    overflow-x: auto;
    white-space: pre;
  }

  /* GUI simulation panel */
  .gui-panel {
    background: #f8fafc;
    border: 2px solid #e2e8f0;
    border-radius: 16px;
    overflow: hidden;
    margin: 14px 0;
  }
  .gui-titlebar {
    background: linear-gradient(90deg, var(--purple), var(--teal-dark));
    padding: 10px 16px;
    display: flex;
    align-items: center;
    gap: 10px;
    color: #fff;
    font-weight: 700;
    font-size: 0.9rem;
  }
  .gui-titlebar .dots {
    display: flex;
    gap: 6px;
  }
  .gui-titlebar .dot-ctrl {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255,255,255,0.3);
  }
  .gui-body {
    padding: 20px;
  }
  .gui-input-row {
    display: flex;
    gap: 10px;
    margin-bottom: 16px;
  }
  .gui-input {
    flex: 1;
    padding: 10px 16px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    font-family: 'Comic Neue', cursive;
    font-size: 0.95rem;
    outline: none;
    transition: border-color 0.2s;
  }
  .gui-input:focus {
    border-color: var(--purple-light);
  }
  .gui-log {
    background: #fff;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    padding: 14px;
    min-height: 200px;
    max-height: 340px;
    overflow-y: auto;
    font-family: 'Fira Code', monospace;
    font-size: 0.82rem;
    line-height: 1.8;
  }
  .gui-log::-webkit-scrollbar { width: 6px; }
  .gui-log::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
  .gui-log .log-system { color: var(--purple); }
  .gui-log .log-assistant { color: #1e1b4b; }
  .gui-log .log-tool { color: var(--teal-dark); }
  .gui-log .log-result { color: var(--green-dark); }
  .gui-log .log-error { color: var(--red-dark); }
  .gui-log .log-dim { color: #94a3b8; }
  .gui-status {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-top: 12px;
    font-size: 0.88rem;
    color: #64748b;
  }
  .status-dot {
    width: 10px;
    height: 10px;
    border-radius: 50%;
    background: #cbd5e1;
  }
  .status-dot.active {
    background: var(--green);
    box-shadow: 0 0 6px rgba(52,211,153,0.5);
    animation: pulse 1.5s ease-in-out infinite;
  }
  .status-dot.done { background: var(--green); }
  .status-dot.error { background: var(--red); }

  @keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    display: inline-block;
    width: 14px; height: 14px;
    border: 2.5px solid #4c3f78;
    border-top-color: var(--purple-light);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    vertical-align: middle;
    margin-right: 6px;
  }

  @media (max-width: 600px) {
    .card { padding: 22px 18px; }
    .btn { padding: 9px 16px; font-size: 0.88rem; }
    .gui-input-row { flex-direction: column; }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .card { animation: fadeUp 0.5s ease both; }
  .card:nth-child(2) { animation-delay: 0.08s; }
  .card:nth-child(3) { animation-delay: 0.16s; }
  .card:nth-child(4) { animation-delay: 0.24s; }
  .card:nth-child(5) { animation-delay: 0.32s; }
  .card:nth-child(6) { animation-delay: 0.40s; }
  .card:nth-child(7) { animation-delay: 0.48s; }
  .card:nth-child(8) { animation-delay: 0.56s; }

  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--purple-dark);
    color: #fff;
    padding: 12px 28px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 0.95rem;
    z-index: 10000;
    box-shadow: 0 6px 20px rgba(124,58,237,0.35);
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    pointer-events: none;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }
</style>
</head>
<body>

<div class="blob blob-1"></div>
<div class="blob blob-2"></div>
<div class="blob blob-3"></div>
<canvas id="confetti-canvas"></canvas>

<header>
  <div class="mascot">&#129302;</div>
  <h1>Claude Code SDK Playground</h1>
  <p>An interactive guide to building apps with the <strong>Claude Code SDK</strong> &mdash; send prompts, add custom tools, stream progress, and bridge a GUI into an agentic coding session!</p>
</header>

<div class="container">

  <!-- 1. Installation -->
  <div class="card purple">
    <h2><span class="icon">&#128230;</span> Installation &amp; Setup</h2>
    <p class="desc">The SDK is an npm package called <code>@anthropic-ai/claude-agent-sdk</code>. Install it, then import <code>query</code> to start making calls.</p>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>setup</span>
      </div>
      <div class="terminal-body" id="install-out"><span class="dim">Click below to install the SDK...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-purple" onclick="runInstall()">&#128229; Install SDK</button>
      <button class="btn btn-outline" onclick="showImports()">&#128196; Show Imports</button>
    </div>
  </div>

  <!-- 2. Basic Query -->
  <div class="card teal">
    <h2><span class="icon">&#128172;</span> Sending a Prompt</h2>
    <p class="desc">Use the <code>query()</code> function to send a prompt. It returns an async generator that streams <code>SDKMessage</code> events &mdash; assistant responses, tool calls, and a final result.</p>
    <div class="code-block">
      <div class="code-bar">
        <div class="dots">
          <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        </div>
        <span class="lang">basic-query.ts</span>
      </div>
      <div class="code-body" id="query-code"></div>
    </div>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>query-output</span>
      </div>
      <div class="terminal-body" id="query-out"><span class="dim">Run the example to see messages stream in...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-teal" onclick="runBasicQuery()">&#9654; Run Query</button>
      <button class="btn btn-outline" onclick="runQueryWithOptions()">&#9881; With Options</button>
    </div>
  </div>

  <!-- 3. Streaming Messages -->
  <div class="card pink">
    <h2><span class="icon">&#127897;</span> Streaming Message Types</h2>
    <p class="desc">The SDK emits many message types as it works. Your app reacts to each type differently &mdash; show text for <code>assistant</code>, animate tool calls for <code>user</code> (tool results), and finalize on <code>result</code>.</p>
    <div class="code-block">
      <div class="code-bar">
        <div class="dots">
          <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        </div>
        <span class="lang">message-types.ts</span>
      </div>
      <div class="code-body" id="stream-code"></div>
    </div>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>stream-demo</span>
      </div>
      <div class="terminal-body" id="stream-out"><span class="dim">Simulate the message stream to see each type...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-pink" onclick="runStreamDemo()">&#127897; Stream Messages</button>
    </div>
  </div>

  <!-- 4. Adding Tools -->
  <div class="card green">
    <h2><span class="icon">&#128295;</span> Adding Custom Tools</h2>
    <p class="desc">Use <code>tool()</code> and <code>createSdkMcpServer()</code> to give Claude access to your app's functionality &mdash; databases, APIs, UI actions &mdash; anything you can wrap in a function.</p>
    <div class="code-block">
      <div class="code-bar">
        <div class="dots">
          <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        </div>
        <span class="lang">custom-tools.ts</span>
      </div>
      <div class="code-body" id="tools-code"></div>
    </div>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>tool-session</span>
      </div>
      <div class="terminal-body" id="tools-out"><span class="dim">Run a session that uses custom tools...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-green" onclick="runToolDemo()">&#128295; Run With Tools</button>
      <button class="btn btn-outline" onclick="showToolList()">&#128203; List All Tools</button>
    </div>
  </div>

  <!-- 5. Permissions -->
  <div class="card orange">
    <h2><span class="icon">&#128274;</span> Permissions &amp; Safety</h2>
    <p class="desc">Control what Claude can do with <code>permissionMode</code> and the <code>canUseTool</code> callback. Your app decides in real time whether to allow, deny, or modify each tool call.</p>
    <div class="code-block">
      <div class="code-bar">
        <div class="dots">
          <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        </div>
        <span class="lang">permissions.ts</span>
      </div>
      <div class="code-body" id="perms-code"></div>
    </div>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>permissions</span>
      </div>
      <div class="terminal-body" id="perms-out"><span class="dim">Try different permission modes...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-orange" onclick="runPermsDemo('default')">&#128274; Default Mode</button>
      <button class="btn btn-orange" onclick="runPermsDemo('bypass')">&#9889; Bypass Mode</button>
      <button class="btn btn-orange" onclick="runPermsDemo('custom')">&#128736; Custom canUseTool</button>
    </div>
  </div>

  <!-- 6. GUI Bridge Demo -->
  <div class="card blue">
    <h2><span class="icon">&#128421;</span> GUI App Bridge</h2>
    <p class="desc">This is the real magic &mdash; bridge a GUI app into an SDK session. Your app sends a task, streams events, and shows live progress. Try it below!</p>
    <div class="gui-panel">
      <div class="gui-titlebar">
        <div class="dots">
          <div class="dot-ctrl"></div>
          <div class="dot-ctrl"></div>
          <div class="dot-ctrl"></div>
        </div>
        <span>My App &mdash; Claude SDK Integration</span>
      </div>
      <div class="gui-body">
        <div class="gui-input-row">
          <input class="gui-input" id="gui-prompt" type="text" placeholder="Describe a task for Claude..." value="Add a dark mode toggle to the settings page">
          <button class="btn btn-blue" id="gui-send-btn" onclick="runGuiDemo()">&#9654; Send</button>
        </div>
        <div class="gui-log" id="gui-log">
          <span class="log-dim">Waiting for a task...</span>
        </div>
        <div class="gui-status">
          <div class="status-dot" id="gui-status-dot"></div>
          <span id="gui-status-text">Idle</span>
        </div>
      </div>
    </div>
    <div class="btn-row">
      <button class="btn btn-blue" onclick="runGuiDemo()">&#128421; Launch Task</button>
      <button class="btn btn-outline" onclick="showGuiCode()">&#128196; View Source</button>
    </div>
  </div>

  <!-- 7. Multi-turn & Resume -->
  <div class="card red">
    <h2><span class="icon">&#128257;</span> Multi-turn &amp; Session Resume</h2>
    <p class="desc">Use streaming input for multi-turn conversations, or <code>resume</code> a previous session by ID. Your app can maintain context across multiple interactions.</p>
    <div class="code-block">
      <div class="code-bar">
        <div class="dots">
          <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        </div>
        <span class="lang">multi-turn.ts</span>
      </div>
      <div class="code-body" id="resume-code"></div>
    </div>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>multi-turn</span>
      </div>
      <div class="terminal-body" id="resume-out"><span class="dim">Try a multi-turn conversation...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-red" onclick="runMultiTurn()">&#128172; Multi-turn Chat</button>
      <button class="btn btn-outline" onclick="runResumeDemo()">&#128257; Resume Session</button>
    </div>
  </div>

  <!-- 8. Score -->
  <div class="card purple">
    <h2><span class="icon">&#127942;</span> Your SDK Score</h2>
    <p class="desc">Complete each section to fill the bar and earn your SDK Master badge!</p>
    <div class="progress-wrap">
      <div class="progress-bar" id="progress-bar" style="width:0%">0%</div>
    </div>
    <div class="score-display">
      <div class="score-num" id="score-num">0 / 7</div>
      <div class="score-label">sections completed</div>
    </div>
    <div id="badges-row" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;justify-content:center;"></div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
// ─── State ──────────────────────────────────────
const completed = new Set();
const TOTAL = 7;

// ─── Helpers ────────────────────────────────────
const $ = id => document.getElementById(id);
const esc = s => s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const wait = ms => new Promise(r => setTimeout(r, ms));
const rand = (a,b) => Math.floor(Math.random()*(b-a+1))+a;

function setTerm(id, html) {
  const el = $(id);
  el.innerHTML = html;
  el.scrollTop = el.scrollHeight;
}

function appendTerm(id, html) {
  const el = $(id);
  el.innerHTML += html;
  el.scrollTop = el.scrollHeight;
}

function pr(cmd) {
  return `<span class="prompt">$ </span><span class="cmd">${esc(cmd)}</span>\n`;
}

function spin() {
  return `<span class="dim"><span class="spinner"></span> Running...</span>\n`;
}

function toast(msg) {
  const t = $('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2400);
}

function markDone(key) {
  if (completed.has(key)) return;
  completed.add(key);
  updateScore();
  toast('\u2705 Section complete: ' + key);
  if (completed.size === TOTAL) {
    setTimeout(() => { launchConfetti(); toast('\uD83C\uDF89 ALL DONE! You are an SDK Master!'); }, 600);
  }
}

function updateScore() {
  const pct = Math.round((completed.size / TOTAL) * 100);
  $('progress-bar').style.width = pct + '%';
  $('progress-bar').textContent = pct + '%';
  $('score-num').textContent = completed.size + ' / ' + TOTAL;

  const row = $('badges-row');
  row.innerHTML = '';
  const names = ['Install','Query','Streaming','Tools','Permissions','GUI Bridge','Multi-turn'];
  const keys  = ['install','query','stream','tools','perms','gui','resume'];
  keys.forEach((k, i) => {
    const done = completed.has(k);
    const b = document.createElement('span');
    b.className = 'badge ' + (done ? 'badge-success' : 'badge-info');
    b.textContent = (done ? '\u2705 ' : '\u2B1C ') + names[i];
    row.appendChild(b);
  });
}

// ─── Syntax highlight helper ────────────────────
function hi(code) {
  return code
    .replace(/\/\/.*/g, m => `<span class="comment">${m}</span>`)
    .replace(/\b(import|from|const|let|async|for await|await|function|if|else|switch|case|break|return|new|of|type)\b/g, '<span class="kw">$1</span>')
    .replace(/"([^"]*)"/g, '<span class="str">"$1"</span>')
    .replace(/'([^']*)'/g, '<span class="str">\'$1\'</span>')
    .replace(/`([^`]*)`/g, '<span class="str">`$1`</span>')
    .replace(/\b(query|tool|createSdkMcpServer|listSessions|console\.log)\b/g, '<span class="fn">$1</span>')
    .replace(/\b(SDKMessage|Options|Query|McpServerConfig|PermissionResult)\b/g, '<span class="type">$1</span>')
    .replace(/\b(\d+)\b/g, '<span class="num">$1</span>');
}

// ─── Populate code blocks ───────────────────────
function initCodeBlocks() {
  // Basic query
  $('query-code').innerHTML = hi(
`import { query } from "@anthropic-ai/claude-agent-sdk";

const conversation = query({
  prompt: "Create a hello world Express server",
  options: {
    cwd: "/my/project",
    permissionMode: "bypassPermissions",
    allowDangerouslySkipPermissions: true,
    tools: { type: "preset", preset: "claude_code" },
    systemPrompt: {
      type: "preset",
      preset: "claude_code"
    },
    maxTurns: 10,
  },
});

// Stream messages as they arrive
for await (const message of conversation) {
  if (message.type === "assistant") {
    // Claude's response with text and tool calls
    console.log("Assistant:", message.message.content);
  } else if (message.type === "result") {
    // Final result with cost, usage, and duration
    console.log("Done!", message.result);
    console.log("Cost: $" + message.total_cost_usd);
  }
}`);

  // Stream code
  $('stream-code').innerHTML = hi(
`for await (const msg of conversation) {
  switch (msg.type) {
    case "system":     // Init: tools, model, session info
      console.log("Session started:", msg.session_id);
      console.log("Tools:", msg.tools);
      break;

    case "assistant":  // Claude's text + tool_use blocks
      for (const block of msg.message.content) {
        if (block.type === "text")
          showText(block.text);
        if (block.type === "tool_use")
          showToolCall(block.name, block.input);
      }
      break;

    case "user":       // Tool results flowing back
      console.log("Tool result:", msg.tool_use_result);
      break;

    case "result":     // Session complete
      console.log("Turns:", msg.num_turns);
      console.log("Cost:", msg.total_cost_usd);
      break;
  }
}`);

  // Tools code
  $('tools-code').innerHTML = hi(
`import { query, tool, createSdkMcpServer } from "@anthropic-ai/claude-agent-sdk";
import { z } from "zod";

// Define a custom tool with Zod schema
const getWeather = tool(
  "get_weather",
  "Fetch current weather for a city",
  { city: z.string(), units: z.enum(["celsius", "fahrenheit"]) },
  async ({ city, units }) => {
    const data = await fetchWeatherAPI(city, units);
    return { content: [{ type: "text", text: JSON.stringify(data) }] };
  }
);

const notifyUser = tool(
  "notify_user",
  "Show a notification in the app UI",
  { title: z.string(), body: z.string(), level: z.enum(["info","warn","error"]) },
  async ({ title, body, level }) => {
    showAppNotification(title, body, level);
    return { content: [{ type: "text", text: "Notification sent" }] };
  }
);

// Bundle tools into an in-process MCP server
const server = createSdkMcpServer({
  name: "my-app-tools",
  tools: [getWeather, notifyUser],
});

// Pass the server to query
const conversation = query({
  prompt: "What's the weather in Tokyo? Notify me with the result.",
  options: {
    mcpServers: { "my-app-tools": server },
  },
});`);

  // Permissions code
  $('perms-code').innerHTML = hi(
`const conversation = query({
  prompt: "Refactor the auth module",
  options: {
    // Option 1: Use a preset permission mode
    permissionMode: "acceptEdits",

    // Option 2: Custom permission callback
    canUseTool: async (toolName, input, { signal }) => {
      if (toolName === "Bash") {
        const ok = await showConfirmDialog(
          "Claude wants to run: " + input.command
        );
        return ok
          ? { behavior: "allow" }
          : { behavior: "deny", message: "User declined" };
      }
      // Allow reads and edits automatically
      return { behavior: "allow" };
    },
  },
});`);

  // Resume code
  $('resume-code').innerHTML = hi(
`import { query, listSessions } from "@anthropic-ai/claude-agent-sdk";

// List past sessions
const sessions = await listSessions({ dir: "/my/project", limit: 5 });
for (const s of sessions) {
  console.log(s.summary, new Date(s.lastModified));
}

// Resume a previous session
const resumed = query({
  prompt: "Now add unit tests for the changes you made",
  options: {
    resume: sessions[0].sessionId,
  },
});

// Multi-turn with streaming input
async function* chatStream() {
  yield { type: "user", session_id: "", message: {
    role: "user",
    content: "Create a React component for a todo list"
  }, parent_tool_use_id: null };

  // Wait for user's next message...
  const next = await getUserInput();

  yield { type: "user", session_id: "", message: {
    role: "user",
    content: next
  }, parent_tool_use_id: null };
}

const multiTurn = query({
  prompt: chatStream(),
});`);
}

// ─── 1. Install ─────────────────────────────────
async function runInstall() {
  const id = 'install-out';
  setTerm(id, pr('npm install @anthropic-ai/claude-agent-sdk') + spin());
  await wait(rand(600, 1000));

  let h = pr('npm install @anthropic-ai/claude-agent-sdk');
  h += `<span class="out">added 12 packages in 3.${rand(1,9)}s</span>\n\n`;
  setTerm(id, h);
  await wait(rand(300, 500));

  h += pr('npm ls @anthropic-ai/claude-agent-sdk');
  setTerm(id, h + spin());
  await wait(rand(400, 700));

  h += `<span class="path">my-app@1.0.0 /home/user/my-app</span>\n`;
  h += `<span class="ok">\u2514\u2500\u2500 @anthropic-ai/claude-agent-sdk@0.1.${rand(5,15)}</span>\n\n`;
  h += `<span class="ok">\u2705 SDK installed and ready!</span>\n`;
  setTerm(id, h);
  markDone('install');
}

async function showImports() {
  const id = 'install-out';
  let h = `<span class="info">// Main exports from the SDK:</span>\n\n`;
  const imports = [
    ['query', 'Send prompts and stream responses'],
    ['tool', 'Define custom MCP tools with Zod schemas'],
    ['createSdkMcpServer', 'Bundle tools into an in-process MCP server'],
    ['listSessions', 'Discover and list past sessions'],
  ];
  for (const [name, desc] of imports) {
    h += `<span class="kw">import</span> { <span class="fn">${name}</span> } <span class="kw">from</span> <span class="str">"@anthropic-ai/claude-agent-sdk"</span>;\n`;
    h += `<span class="dim">  // ${desc}</span>\n\n`;
    setTerm(id, h);
    await wait(rand(200, 400));
  }
  h += `<span class="ok">\u2705 These are the core building blocks!</span>\n`;
  setTerm(id, h);
  markDone('install');
}

// ─── 2. Basic Query ─────────────────────────────
async function runBasicQuery() {
  const id = 'query-out';
  setTerm(id, `<span class="info">\u25B6 Running query({ prompt: "Create a hello world Express server" })...</span>\n\n`);
  await wait(rand(400, 700));

  // system init
  appendTerm(id, `<span class="log-system">[system]</span> <span class="dim">Session initialized</span>\n`);
  appendTerm(id, `<span class="dim">  model: claude-sonnet-4-20250514</span>\n`);
  appendTerm(id, `<span class="dim">  tools: Read, Write, Edit, Bash, Glob, Grep</span>\n\n`);
  await wait(rand(300, 600));

  // assistant thinking
  appendTerm(id, `<span class="info">[assistant]</span> I'll create a simple Express server for you.\n\n`);
  await wait(rand(400, 700));

  // tool call
  appendTerm(id, `<span class="type">[tool_use]</span> <span class="fn">Write</span>\n`);
  appendTerm(id, `<span class="dim">  file_path: "/my/project/server.js"</span>\n`);
  await wait(rand(300, 500));

  appendTerm(id, `<span class="ok">[tool_result]</span> <span class="dim">File written successfully</span>\n\n`);
  await wait(rand(300, 500));

  // another assistant message
  appendTerm(id, `<span class="info">[assistant]</span> Now let me install Express and test it.\n\n`);
  await wait(rand(300, 500));

  appendTerm(id, `<span class="type">[tool_use]</span> <span class="fn">Bash</span>\n`);
  appendTerm(id, `<span class="dim">  command: "npm init -y && npm install express"</span>\n`);
  await wait(rand(500, 800));

  appendTerm(id, `<span class="ok">[tool_result]</span> <span class="dim">added 64 packages in 2.1s</span>\n\n`);
  await wait(rand(200, 400));

  // result
  appendTerm(id, `<span class="ok">[result]</span> <span class="ok">\u2705 Success</span>\n`);
  appendTerm(id, `<span class="dim">  turns: 3  |  cost: $0.012  |  duration: 8.${rand(1,9)}s</span>\n`);
  markDone('query');
}

async function runQueryWithOptions() {
  const id = 'query-out';
  setTerm(id, '');
  const opts = [
    ['cwd', '"/path/to/project"', 'Working directory for the session'],
    ['model', '"claude-sonnet-4-20250514"', 'Which Claude model to use'],
    ['maxTurns', '15', 'Max conversation turns before stopping'],
    ['maxBudgetUsd', '0.50', 'Spending cap in USD'],
    ['permissionMode', '"acceptEdits"', 'Auto-accept file edits'],
    ['systemPrompt', '{ type: "preset", preset: "claude_code" }', 'Use Claude Code system prompt'],
    ['tools', '{ type: "preset", preset: "claude_code" }', 'Use Claude Code default tools'],
    ['allowedTools', '["Read", "Write", "Grep"]', 'Restrict to specific tools'],
    ['effort', '"high"', 'Controls thinking depth'],
    ['resume', '"session-uuid"', 'Resume a previous session'],
  ];

  let h = `<span class="info">// Available options for query():</span>\n\n`;
  for (const [key, val, desc] of opts) {
    h += `<span class="path">${key}</span>: <span class="str">${esc(val)}</span>\n`;
    h += `<span class="dim">  // ${desc}</span>\n\n`;
    setTerm(id, h);
    await wait(rand(150, 300));
  }
  h += `<span class="ok">\u2705 Full options reference loaded!</span>\n`;
  setTerm(id, h);
  markDone('query');
}

// ─── 3. Streaming Demo ─────────────────────────
async function runStreamDemo() {
  const id = 'stream-out';
  setTerm(id, '');

  const events = [
    { type: 'system', sub: 'init', detail: 'Session abc-123 initialized, model: claude-sonnet-4-20250514', delay: 300 },
    { type: 'system', sub: 'init', detail: 'Tools: [Read, Write, Edit, Bash, Glob, Grep]', delay: 200 },
    { type: 'assistant', sub: '', detail: 'I\'ll help you build a REST API. Let me start by reading the project structure.', delay: 600 },
    { type: 'assistant', sub: 'tool_use', detail: 'Glob({ pattern: "src/**/*.ts" })', delay: 400 },
    { type: 'user', sub: 'tool_result', detail: '["src/index.ts", "src/routes.ts", "src/db.ts"]', delay: 500 },
    { type: 'assistant', sub: '', detail: 'I see the project structure. Let me read the existing routes.', delay: 400 },
    { type: 'assistant', sub: 'tool_use', detail: 'Read({ file_path: "src/routes.ts" })', delay: 400 },
    { type: 'user', sub: 'tool_result', detail: '(file contents: 42 lines)', delay: 300 },
    { type: 'assistant', sub: '', detail: 'Now I\'ll add the new endpoints.', delay: 400 },
    { type: 'assistant', sub: 'tool_use', detail: 'Edit({ file_path: "src/routes.ts", old_string: "...", new_string: "..." })', delay: 500 },
    { type: 'user', sub: 'tool_result', detail: 'File edited successfully', delay: 300 },
    { type: 'result', sub: 'success', detail: 'turns: 4, cost: $0.018, duration: 11.2s', delay: 200 },
  ];

  const colors = {
    system: 'log-system',
    assistant: 'info',
    user: 'ok',
    result: 'path',
  };

  for (const ev of events) {
    const label = ev.sub ? `${ev.type}:${ev.sub}` : ev.type;
    const cls = colors[ev.type] || 'out';
    appendTerm(id, `<span class="${cls}">[${label}]</span> <span class="out">${esc(ev.detail)}</span>\n`);
    await wait(ev.delay + rand(100, 300));
  }

  appendTerm(id, `\n<span class="ok">\u2705 Stream complete! 12 messages received.</span>\n`);
  markDone('stream');
}

// ─── 4. Tools Demo ──────────────────────────────
async function runToolDemo() {
  const id = 'tools-out';
  setTerm(id, `<span class="info">\u25B6 Starting session with custom MCP tools...</span>\n\n`);
  await wait(rand(400, 700));

  appendTerm(id, `<span class="log-system">[system]</span> <span class="dim">MCP server "my-app-tools" connected</span>\n`);
  appendTerm(id, `<span class="dim">  Tools registered: get_weather, notify_user</span>\n\n`);
  await wait(rand(300, 500));

  appendTerm(id, `<span class="info">[assistant]</span> I'll check the weather in Tokyo and notify you.\n\n`);
  await wait(rand(400, 600));

  appendTerm(id, `<span class="type">[tool_use]</span> <span class="fn">mcp__my-app-tools__get_weather</span>\n`);
  appendTerm(id, `<span class="dim">  { city: "Tokyo", units: "celsius" }</span>\n`);
  await wait(rand(600, 1000));

  appendTerm(id, `<span class="ok">[tool_result]</span>\n`);
  appendTerm(id, `<span class="out">  { temp: 22, condition: "Partly Cloudy", humidity: 65 }</span>\n\n`);
  await wait(rand(300, 500));

  appendTerm(id, `<span class="type">[tool_use]</span> <span class="fn">mcp__my-app-tools__notify_user</span>\n`);
  appendTerm(id, `<span class="dim">  { title: "Weather Update", body: "Tokyo: 22\u00B0C, Partly Cloudy", level: "info" }</span>\n`);
  await wait(rand(400, 600));

  appendTerm(id, `<span class="ok">[tool_result]</span> <span class="dim">Notification sent</span>\n\n`);
  await wait(rand(200, 400));

  appendTerm(id, `<span class="info">[assistant]</span> The weather in Tokyo is 22\u00B0C and Partly Cloudy.\n`);
  appendTerm(id, `<span class="info">           </span> I've sent a notification to your app!\n\n`);
  appendTerm(id, `<span class="ok">[result] \u2705 Success  |  turns: 2  |  cost: $0.008</span>\n`);

  toast('\uD83D\uDD14 Weather Update: Tokyo 22\u00B0C');
  markDone('tools');
}

async function showToolList() {
  const id = 'tools-out';
  setTerm(id, `<span class="info">// Built-in tools (from preset: "claude_code"):</span>\n\n`);

  const tools = [
    ['Read', 'Read file contents from disk'],
    ['Write', 'Create or overwrite files'],
    ['Edit', 'Make targeted edits to existing files'],
    ['Bash', 'Execute shell commands'],
    ['Glob', 'Find files by pattern matching'],
    ['Grep', 'Search file contents with regex'],
    ['Task', 'Launch sub-agent for complex tasks'],
    ['WebFetch', 'Fetch and process web content'],
    ['WebSearch', 'Search the web for information'],
    ['TodoWrite', 'Track progress with a task list'],
    ['NotebookEdit', 'Edit Jupyter notebook cells'],
  ];

  let h = $('tools-out').innerHTML;
  for (const [name, desc] of tools) {
    h += `<span class="fn">${name.padEnd(16)}</span> <span class="dim">${desc}</span>\n`;
    setTerm(id, h);
    await wait(rand(80, 180));
  }

  h += `\n<span class="info">// Custom tools (from your MCP server):</span>\n\n`;
  h += `<span class="ok">get_weather      Fetch current weather for a city</span>\n`;
  h += `<span class="ok">notify_user      Show a notification in the app UI</span>\n`;
  h += `\n<span class="ok">\u2705 ${tools.length + 2} tools available in this session</span>\n`;
  setTerm(id, h);
  markDone('tools');
}

// ─── 5. Permissions Demo ────────────────────────
async function runPermsDemo(mode) {
  const id = 'perms-out';
  setTerm(id, '');

  if (mode === 'default') {
    appendTerm(id, `<span class="info">\u25B6 permissionMode: "default"</span>\n\n`);
    await wait(300);
    appendTerm(id, `<span class="out">[assistant] Let me edit the auth module...</span>\n\n`);
    await wait(500);
    appendTerm(id, `<span class="path">[permission_request]</span> <span class="out">Edit: src/auth.ts</span>\n`);
    appendTerm(id, `<span class="dim">  Claude wants to modify src/auth.ts</span>\n`);
    appendTerm(id, `<span class="dim">  Your app must call canUseTool to decide</span>\n\n`);
    await wait(600);
    appendTerm(id, `<span class="err">\u23F8 Session paused &mdash; waiting for user approval</span>\n\n`);
    await wait(400);
    appendTerm(id, `<span class="ok">\u2705 User approved the edit</span>\n`);
    appendTerm(id, `<span class="out">[tool_result] File edited successfully</span>\n`);

  } else if (mode === 'bypass') {
    appendTerm(id, `<span class="info">\u25B6 permissionMode: "bypassPermissions"</span>\n`);
    appendTerm(id, `<span class="path">\u26A0\uFE0F  Requires: allowDangerouslySkipPermissions: true</span>\n\n`);
    await wait(300);
    appendTerm(id, `<span class="out">[assistant] Editing auth module...</span>\n`);
    await wait(300);
    appendTerm(id, `<span class="ok">[tool_use] Edit: src/auth.ts</span> <span class="dim">(auto-approved)</span>\n`);
    await wait(200);
    appendTerm(id, `<span class="ok">[tool_use] Bash: npm test</span> <span class="dim">(auto-approved)</span>\n`);
    await wait(200);
    appendTerm(id, `<span class="ok">[tool_use] Write: src/auth.test.ts</span> <span class="dim">(auto-approved)</span>\n\n`);
    await wait(300);
    appendTerm(id, `<span class="ok">\u2705 All tools auto-approved in bypass mode</span>\n`);
    appendTerm(id, `<span class="dim">   Use this for CI/CD and trusted automation only!</span>\n`);

  } else {
    appendTerm(id, `<span class="info">\u25B6 Custom canUseTool callback</span>\n\n`);
    await wait(300);

    const calls = [
      { tool: 'Read', input: 'src/auth.ts', result: 'allow', reason: 'Reads are always safe' },
      { tool: 'Edit', input: 'src/auth.ts', result: 'allow', reason: 'Edits allowed by policy' },
      { tool: 'Bash', input: 'rm -rf /', result: 'deny', reason: 'Dangerous command blocked!' },
      { tool: 'Bash', input: 'npm test', result: 'allow', reason: 'Test commands are allowed' },
      { tool: 'Write', input: '.env', result: 'deny', reason: 'Cannot write sensitive files' },
    ];

    for (const c of calls) {
      appendTerm(id, `<span class="type">[canUseTool]</span> <span class="fn">${c.tool}</span>(<span class="dim">${esc(c.input)}</span>)\n`);
      await wait(rand(200, 400));

      if (c.result === 'allow') {
        appendTerm(id, `  <span class="ok">\u2705 ALLOW</span> <span class="dim">${c.reason}</span>\n\n`);
      } else {
        appendTerm(id, `  <span class="err">\u274C DENY</span> <span class="dim">${c.reason}</span>\n\n`);
      }
      await wait(rand(200, 400));
    }
    appendTerm(id, `<span class="ok">\u2705 Custom permission logic handled 5 tool calls</span>\n`);
  }

  markDone('perms');
}

// ─── 6. GUI Bridge Demo ────────────────────────
async function runGuiDemo() {
  const log = $('gui-log');
  const dot = $('gui-status-dot');
  const status = $('gui-status-text');
  const btn = $('gui-send-btn');
  const promptVal = $('gui-prompt').value || 'Add a dark mode toggle to the settings page';

  log.innerHTML = '';
  btn.disabled = true;
  dot.className = 'status-dot active';
  status.textContent = 'Connecting...';

  const addLog = (cls, text) => {
    log.innerHTML += `<span class="${cls}">${text}</span>\n`;
    log.scrollTop = log.scrollHeight;
  };

  await wait(rand(300, 600));
  addLog('log-system', '\u25B6 query({ prompt: "' + esc(promptVal) + '" })');
  addLog('log-dim', '  Initializing session...');
  status.textContent = 'Initializing...';
  await wait(rand(500, 900));

  addLog('log-system', '\u2705 Session started: sid_' + Math.random().toString(36).slice(2,10));
  addLog('log-dim', '  Model: claude-sonnet-4-20250514 | Tools: 13 loaded');
  status.textContent = 'Working...';
  await wait(rand(400, 700));

  addLog('', '');
  addLog('log-assistant', '\uD83E\uDD16 Claude: I\'ll add a dark mode toggle. Let me first check the current settings page.');
  await wait(rand(400, 600));

  addLog('log-tool', '\uD83D\uDD27 Tool: Read({ file_path: "src/components/Settings.tsx" })');
  status.textContent = 'Reading Settings.tsx...';
  await wait(rand(600, 900));

  addLog('log-dim', '  \u2192 Read 156 lines');
  await wait(rand(200, 400));

  addLog('', '');
  addLog('log-assistant', '\uD83E\uDD16 Claude: I see the settings structure. I\'ll add a ThemeToggle component and wire it up.');
  await wait(rand(500, 800));

  addLog('log-tool', '\uD83D\uDD27 Tool: Write({ file_path: "src/components/ThemeToggle.tsx" })');
  status.textContent = 'Creating ThemeToggle.tsx...';
  await wait(rand(700, 1100));

  addLog('log-dim', '  \u2192 Created new file (48 lines)');
  await wait(rand(200, 400));

  addLog('log-tool', '\uD83D\uDD27 Tool: Edit({ file_path: "src/components/Settings.tsx" })');
  status.textContent = 'Editing Settings.tsx...';
  await wait(rand(600, 900));

  addLog('log-dim', '  \u2192 Added import + toggle component');
  await wait(rand(200, 400));

  addLog('log-tool', '\uD83D\uDD27 Tool: Edit({ file_path: "src/styles/theme.css" })');
  status.textContent = 'Adding dark mode CSS...';
  await wait(rand(500, 800));

  addLog('log-dim', '  \u2192 Added CSS variables for dark theme');
  await wait(rand(200, 400));

  addLog('', '');
  addLog('log-assistant', '\uD83E\uDD16 Claude: Let me verify everything compiles.');
  await wait(rand(300, 500));

  addLog('log-tool', '\uD83D\uDD27 Tool: Bash({ command: "npm run build" })');
  status.textContent = 'Building project...';
  await wait(rand(800, 1200));

  addLog('log-dim', '  \u2192 Build completed successfully');
  await wait(rand(300, 500));

  addLog('', '');
  addLog('log-assistant', '\uD83E\uDD16 Claude: Dark mode toggle is ready! I created a ThemeToggle component,');
  addLog('log-assistant', '         added it to Settings, and set up CSS custom properties for theming.');
  await wait(rand(300, 500));

  addLog('', '');
  addLog('log-result', '\u2705 Result: Success | Turns: 5 | Cost: $0.02' + rand(1,9) + ' | Duration: ' + rand(8,14) + '.' + rand(1,9) + 's');

  dot.className = 'status-dot done';
  status.textContent = 'Complete';
  btn.disabled = false;
  markDone('gui');
}

function showGuiCode() {
  const id = 'gui-log';
  $(id).innerHTML = '';
  const code = `<span class="log-dim">// How this GUI bridge works under the hood:</span>

<span class="kw">import</span> { <span class="fn">query</span> } <span class="kw">from</span> <span class="str">"@anthropic-ai/claude-agent-sdk"</span>;

<span class="kw">async function</span> <span class="fn">handleSendClick</span>(prompt) {
  updateUI({ status: <span class="str">"connecting"</span> });

  <span class="kw">const</span> conversation = <span class="fn">query</span>({
    prompt,
    options: {
      cwd: projectDir,
      tools: { type: <span class="str">"preset"</span>, preset: <span class="str">"claude_code"</span> },
      systemPrompt: { type: <span class="str">"preset"</span>, preset: <span class="str">"claude_code"</span> },
      permissionMode: <span class="str">"acceptEdits"</span>,
    },
  });

  <span class="kw">for await</span> (<span class="kw">const</span> msg <span class="kw">of</span> conversation) {
    <span class="kw">switch</span> (msg.type) {
      <span class="kw">case</span> <span class="str">"system"</span>:
        addLog(<span class="str">"Session started: "</span> + msg.session_id);
        <span class="kw">break</span>;
      <span class="kw">case</span> <span class="str">"assistant"</span>:
        <span class="kw">for</span> (<span class="kw">const</span> block <span class="kw">of</span> msg.message.content) {
          <span class="kw">if</span> (block.type === <span class="str">"text"</span>)
            addLog(<span class="str">"Claude: "</span> + block.text);
          <span class="kw">if</span> (block.type === <span class="str">"tool_use"</span>)
            addLog(<span class="str">"Tool: "</span> + block.name + <span class="str">"("</span> + JSON.stringify(block.input) + <span class="str">")"</span>);
        }
        <span class="kw">break</span>;
      <span class="kw">case</span> <span class="str">"result"</span>:
        addLog(<span class="str">"Done! Cost: $"</span> + msg.total_cost_usd);
        updateUI({ status: <span class="str">"complete"</span> });
        <span class="kw">break</span>;
    }
  }
}`;
  $(id).innerHTML = code;
  markDone('gui');
}

// ─── 7. Multi-turn Demo ────────────────────────
async function runMultiTurn() {
  const id = 'resume-out';
  setTerm(id, `<span class="info">\u25B6 Starting multi-turn conversation...</span>\n\n`);
  await wait(rand(400, 700));

  appendTerm(id, `<span class="path">[turn 1]</span> <span class="out">User: "Create a React component for a todo list"</span>\n`);
  await wait(rand(400, 600));

  appendTerm(id, `<span class="info">[assistant]</span> I'll create a TodoList component with add/remove functionality.\n`);
  await wait(rand(300, 500));

  appendTerm(id, `<span class="type">[tool_use]</span> Write: src/TodoList.tsx\n`);
  await wait(rand(400, 700));

  appendTerm(id, `<span class="ok">[tool_result]</span> <span class="dim">File created (67 lines)</span>\n\n`);
  await wait(rand(300, 500));

  appendTerm(id, `<span class="dim">\u23F8 Waiting for next user message...</span>\n\n`);
  await wait(rand(600, 900));

  appendTerm(id, `<span class="path">[turn 2]</span> <span class="out">User: "Now add drag-and-drop reordering"</span>\n`);
  await wait(rand(400, 600));

  appendTerm(id, `<span class="info">[assistant]</span> I'll add drag-and-drop using the HTML5 Drag API.\n`);
  await wait(rand(300, 500));

  appendTerm(id, `<span class="type">[tool_use]</span> Edit: src/TodoList.tsx\n`);
  await wait(rand(500, 800));

  appendTerm(id, `<span class="ok">[tool_result]</span> <span class="dim">Added drag handlers + state logic</span>\n\n`);
  await wait(rand(200, 400));

  appendTerm(id, `<span class="ok">[result] \u2705 Multi-turn complete  |  2 turns  |  cost: $0.015</span>\n`);
  appendTerm(id, `<span class="dim">  Session ID: sid_${Math.random().toString(36).slice(2,10)} (can be resumed later)</span>\n`);
  markDone('resume');
}

async function runResumeDemo() {
  const id = 'resume-out';
  setTerm(id, `<span class="info">\u25B6 Listing previous sessions...</span>\n\n`);
  await wait(rand(400, 700));

  const sessions = [
    { id: 'sid_' + Math.random().toString(36).slice(2,10), summary: 'Add dark mode toggle', date: '2 hours ago', branch: 'feat/dark-mode' },
    { id: 'sid_' + Math.random().toString(36).slice(2,10), summary: 'Fix auth middleware bug', date: '5 hours ago', branch: 'fix/auth' },
    { id: 'sid_' + Math.random().toString(36).slice(2,10), summary: 'Create todo list component', date: 'yesterday', branch: 'feat/todos' },
  ];

  let h = $('resume-out').innerHTML;
  h += `<span class="fn">listSessions</span>({ dir: <span class="str">"/my/project"</span> })\n\n`;
  for (const s of sessions) {
    h += `<span class="path">${s.id}</span>\n`;
    h += `<span class="out">  "${s.summary}"</span>\n`;
    h += `<span class="dim">  ${s.date} \u2022 branch: ${s.branch}</span>\n\n`;
    setTerm(id, h);
    await wait(rand(200, 400));
  }

  h += `<span class="info">\u25B6 Resuming session: ${sessions[2].id}...</span>\n\n`;
  setTerm(id, h);
  await wait(rand(500, 800));

  h += `<span class="ok">[system]</span> <span class="dim">Session resumed with full context</span>\n`;
  h += `<span class="out">  Previous: "Create todo list component" (3 turns)</span>\n\n`;
  h += `<span class="path">[resumed]</span> <span class="out">User: "Now add unit tests for the TodoList"</span>\n\n`;
  setTerm(id, h);
  await wait(rand(400, 600));

  h += `<span class="info">[assistant]</span> I remember the TodoList component I created. I'll add tests using Vitest.\n\n`;
  h += `<span class="type">[tool_use]</span> Write: src/TodoList.test.tsx\n`;
  setTerm(id, h);
  await wait(rand(400, 600));

  h += `<span class="ok">[tool_result]</span> <span class="dim">Created test file (45 lines, 4 test cases)</span>\n\n`;
  h += `<span class="ok">[result] \u2705 Resumed session complete  |  cost: $0.009</span>\n`;
  setTerm(id, h);
  markDone('resume');
}

// ─── Confetti ───────────────────────────────────
function launchConfetti() {
  const canvas = $('confetti-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const pieces = [];
  const colors = ['#7c3aed','#ec4899','#2dd4bf','#fbbf24','#60a5fa','#fb923c','#34d399'];

  for (let i = 0; i < 180; i++) {
    pieces.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height - canvas.height,
      w: Math.random() * 10 + 5,
      h: Math.random() * 6 + 3,
      color: colors[Math.floor(Math.random() * colors.length)],
      vy: Math.random() * 3 + 2,
      vx: (Math.random() - 0.5) * 2,
      rot: Math.random() * 360,
      rv: (Math.random() - 0.5) * 8,
    });
  }

  let frame = 0;
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    pieces.forEach(p => {
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate((p.rot * Math.PI) / 180);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
      ctx.restore();
      p.y += p.vy;
      p.x += p.vx;
      p.rot += p.rv;
    });
    frame++;
    if (frame < 200) requestAnimationFrame(draw);
    else ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  draw();
}

// ─── Init ───────────────────────────────────────
initCodeBlocks();
updateScore();
</script>
</body>
</html>
