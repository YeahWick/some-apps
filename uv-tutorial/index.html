<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UV Playground</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Comic+Neue:wght@400;700&family=Fira+Code:wght@400;600&display=swap');

  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --purple: #7c3aed;
    --purple-light: #a78bfa;
    --purple-dark: #5b21b6;
    --pink: #ec4899;
    --yellow: #fbbf24;
    --green: #34d399;
    --green-dark: #059669;
    --red: #f87171;
    --red-dark: #dc2626;
    --blue: #60a5fa;
    --orange: #fb923c;
    --bg: #fef3c7;
    --card-bg: #ffffff;
    --terminal-bg: #1e1b2e;
    --terminal-text: #e2e8f0;
  }

  body {
    font-family: 'Comic Neue', cursive, sans-serif;
    background: var(--bg);
    background-image:
      radial-gradient(circle at 10% 20%, rgba(124,58,237,0.08) 0%, transparent 50%),
      radial-gradient(circle at 90% 80%, rgba(236,72,153,0.08) 0%, transparent 50%),
      radial-gradient(circle at 50% 50%, rgba(251,191,36,0.06) 0%, transparent 60%);
    min-height: 100vh;
    color: #1e1b4b;
    overflow-x: hidden;
  }

  .blob {
    position: fixed;
    border-radius: 50%;
    opacity: 0.12;
    z-index: 0;
    animation: blobFloat 8s ease-in-out infinite alternate;
    pointer-events: none;
  }
  .blob-1 { width: 300px; height: 300px; background: var(--purple); top: -80px; left: -60px; }
  .blob-2 { width: 200px; height: 200px; background: var(--pink); bottom: 10%; right: -40px; animation-delay: -3s; }
  .blob-3 { width: 250px; height: 250px; background: var(--yellow); top: 40%; left: 70%; animation-delay: -5s; }

  @keyframes blobFloat {
    to { transform: translate(30px, 20px) scale(1.08); }
  }

  header {
    text-align: center;
    padding: 50px 20px 30px;
    position: relative;
    z-index: 1;
  }
  header h1 {
    font-family: 'Fredoka One', cursive;
    font-size: clamp(2.4rem, 6vw, 4rem);
    background: linear-gradient(135deg, var(--purple), var(--pink));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    filter: drop-shadow(2px 4px 0 rgba(124,58,237,0.18));
    margin-bottom: 8px;
  }
  header .mascot {
    font-size: 3.6rem;
    animation: bounce 1.6s ease-in-out infinite;
    display: inline-block;
  }
  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-12px); }
  }
  header p {
    font-size: 1.15rem;
    color: #6b7280;
    max-width: 540px;
    margin: 0 auto;
    line-height: 1.6;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    padding: 0 20px 60px;
    position: relative;
    z-index: 1;
  }

  .card {
    background: var(--card-bg);
    border-radius: 24px;
    padding: 32px;
    margin-bottom: 28px;
    box-shadow: 0 4px 24px rgba(124,58,237,0.08), 0 1px 3px rgba(0,0,0,0.06);
    border: 2.5px solid transparent;
    transition: border-color 0.3s, transform 0.2s;
    position: relative;
    overflow: hidden;
  }
  .card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 5px;
    border-radius: 24px 24px 0 0;
  }
  .card:hover { transform: translateY(-2px); }
  .card.purple::before { background: linear-gradient(90deg, var(--purple), var(--purple-light)); }
  .card.pink::before   { background: linear-gradient(90deg, var(--pink), #f9a8d4); }
  .card.green::before  { background: linear-gradient(90deg, var(--green-dark), var(--green)); }
  .card.blue::before   { background: linear-gradient(90deg, #3b82f6, var(--blue)); }
  .card.orange::before { background: linear-gradient(90deg, #ea580c, var(--orange)); }
  .card.red::before    { background: linear-gradient(90deg, var(--red-dark), var(--red)); }

  .card h2 {
    font-family: 'Fredoka One', cursive;
    font-size: 1.55rem;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .card h2 .icon { font-size: 1.7rem; }
  .card .desc {
    color: #6b7280;
    margin-bottom: 18px;
    line-height: 1.55;
  }

  .terminal {
    background: var(--terminal-bg);
    border-radius: 14px;
    overflow: hidden;
    margin: 14px 0;
    box-shadow: inset 0 2px 8px rgba(0,0,0,0.25);
  }
  .terminal-bar {
    background: #2d2640;
    padding: 8px 14px;
    display: flex;
    align-items: center;
    gap: 7px;
  }
  .terminal-dot {
    width: 11px; height: 11px;
    border-radius: 50%;
  }
  .terminal-dot.r { background: #f87171; }
  .terminal-dot.y { background: #fbbf24; }
  .terminal-dot.g { background: #34d399; }
  .terminal-bar span {
    color: #a78bfa;
    font-family: 'Fira Code', monospace;
    font-size: 0.78rem;
    margin-left: 8px;
  }
  .terminal-body {
    padding: 16px 18px;
    font-family: 'Fira Code', monospace;
    font-size: 0.88rem;
    color: var(--terminal-text);
    min-height: 50px;
    max-height: 380px;
    overflow-y: auto;
    white-space: pre-wrap;
    word-break: break-all;
    line-height: 1.6;
  }
  .terminal-body::-webkit-scrollbar { width: 6px; }
  .terminal-body::-webkit-scrollbar-thumb { background: #4c3f78; border-radius: 3px; }

  .prompt { color: var(--green); }
  .cmd { color: #f1f5f9; }
  .out { color: #cbd5e1; }
  .ok { color: #34d399; }
  .err { color: #f87171; }
  .info { color: #60a5fa; }
  .path { color: #fbbf24; }
  .dim { color: #64748b; }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 11px 22px;
    border-radius: 50px;
    border: none;
    font-family: 'Comic Neue', cursive;
    font-weight: 700;
    font-size: 0.95rem;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 3px 0 rgba(0,0,0,0.15);
    position: relative;
    top: 0;
  }
  .btn:active {
    top: 3px;
    box-shadow: 0 0 0 rgba(0,0,0,0.15);
  }
  .btn:disabled {
    opacity: 0.55;
    cursor: not-allowed;
  }
  .btn-purple { background: var(--purple); color: #fff; }
  .btn-purple:hover:not(:disabled) { background: var(--purple-dark); }
  .btn-pink { background: var(--pink); color: #fff; }
  .btn-pink:hover:not(:disabled) { background: #db2777; }
  .btn-green { background: var(--green-dark); color: #fff; }
  .btn-green:hover:not(:disabled) { background: #047857; }
  .btn-red { background: var(--red-dark); color: #fff; }
  .btn-red:hover:not(:disabled) { background: #b91c1c; }
  .btn-blue { background: #3b82f6; color: #fff; }
  .btn-blue:hover:not(:disabled) { background: #2563eb; }
  .btn-orange { background: #ea580c; color: #fff; }
  .btn-orange:hover:not(:disabled) { background: #c2410c; }
  .btn-outline {
    background: transparent;
    border: 2.5px solid var(--purple);
    color: var(--purple);
    box-shadow: none;
  }
  .btn-outline:hover:not(:disabled) { background: rgba(124,58,237,0.08); }

  .btn-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 14px;
  }

  .badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 5px 14px;
    border-radius: 50px;
    font-size: 0.82rem;
    font-weight: 700;
  }
  .badge-success { background: #d1fae5; color: #047857; }
  .badge-info { background: #dbeafe; color: #1d4ed8; }

  .tool-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 12px;
    margin: 16px 0;
  }
  .tool-card {
    background: #f8f5ff;
    border: 2px solid #e9e0ff;
    border-radius: 16px;
    padding: 16px;
    text-align: center;
    transition: all 0.2s;
    cursor: default;
  }
  .tool-card:hover {
    border-color: var(--purple-light);
    transform: scale(1.03);
  }
  .tool-card .tool-icon { font-size: 2rem; margin-bottom: 6px; }
  .tool-card .tool-name {
    font-family: 'Fredoka One', cursive;
    font-size: 1rem;
    margin-bottom: 4px;
  }
  .tool-card .tool-desc {
    font-size: 0.8rem;
    color: #6b7280;
    margin-bottom: 10px;
  }
  .tool-card .tool-status {
    font-size: 0.78rem;
    font-weight: 700;
  }

  @keyframes spin { to { transform: rotate(360deg); } }
  .spinner {
    display: inline-block;
    width: 14px; height: 14px;
    border: 2.5px solid #4c3f78;
    border-top-color: var(--purple-light);
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
    vertical-align: middle;
    margin-right: 6px;
  }

  .progress-wrap {
    background: #e5e7eb;
    border-radius: 50px;
    height: 22px;
    overflow: hidden;
    margin: 12px 0;
  }
  .progress-bar {
    height: 100%;
    border-radius: 50px;
    background: linear-gradient(90deg, var(--purple), var(--pink));
    transition: width 0.5s ease;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding-right: 10px;
    font-size: 0.72rem;
    font-weight: 700;
    color: #fff;
    min-width: 36px;
  }

  #confetti-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    z-index: 9999;
  }

  .score-display {
    text-align: center;
    padding: 20px;
    background: linear-gradient(135deg, #f8f5ff, #fce7f3);
    border-radius: 18px;
    margin: 14px 0;
  }
  .score-num {
    font-family: 'Fredoka One', cursive;
    font-size: 3rem;
    background: linear-gradient(135deg, var(--purple), var(--pink));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }
  .score-label { color: #6b7280; font-size: 0.9rem; }

  @media (max-width: 600px) {
    .card { padding: 22px 18px; }
    .tool-grid { grid-template-columns: 1fr 1fr; }
    .btn { padding: 9px 16px; font-size: 0.88rem; }
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(16px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .card { animation: fadeUp 0.5s ease both; }
  .card:nth-child(2) { animation-delay: 0.08s; }
  .card:nth-child(3) { animation-delay: 0.16s; }
  .card:nth-child(4) { animation-delay: 0.24s; }
  .card:nth-child(5) { animation-delay: 0.32s; }
  .card:nth-child(6) { animation-delay: 0.40s; }
  .card:nth-child(7) { animation-delay: 0.48s; }

  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%) translateY(80px);
    background: var(--purple-dark);
    color: #fff;
    padding: 12px 28px;
    border-radius: 50px;
    font-weight: 700;
    font-size: 0.95rem;
    z-index: 10000;
    box-shadow: 0 6px 20px rgba(124,58,237,0.35);
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1);
    pointer-events: none;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  @keyframes cursorBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }
  .cursor {
    display: inline-block;
    width: 8px;
    height: 15px;
    background: var(--green);
    animation: cursorBlink 1s step-end infinite;
    vertical-align: middle;
    margin-left: 2px;
  }
</style>
</head>
<body>

<div class="blob blob-1"></div>
<div class="blob blob-2"></div>
<div class="blob blob-3"></div>
<canvas id="confetti-canvas"></canvas>

<header>
  <div class="mascot">&#127793;</div>
  <h1>UV Playground</h1>
  <p>A fun, interactive tutorial to explore <strong>uv</strong> &mdash; the blazing-fast Python package manager. Click around, watch the terminals come alive, and earn your UV Master badge!</p>
</header>

<div class="container">

  <!-- 1. Health Check -->
  <div class="card purple">
    <h2><span class="icon">&#129657;</span> Health Check</h2>
    <p class="desc">First things first &mdash; let's make sure <code>uv</code> is installed and reachable!</p>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>health-check</span>
      </div>
      <div class="terminal-body" id="health-out"><span class="dim">Waiting for you to press the button...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-purple" id="btn-health" onclick="runHealthCheck()">&#9889; Run Health Check</button>
    </div>
  </div>

  <!-- 2. Version & Sys Info -->
  <div class="card pink">
    <h2><span class="icon">&#128270;</span> Version &amp; System Info</h2>
    <p class="desc">See what version of uv you're running and gather some handy system details.</p>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>system-info</span>
      </div>
      <div class="terminal-body" id="sysinfo-out"><span class="dim">Click below to discover your uv details...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-pink" id="btn-sysinfo" onclick="runSysInfo()">&#128269; Discover Info</button>
    </div>
  </div>

  <!-- 3. Python Manager -->
  <div class="card green">
    <h2><span class="icon">&#128013;</span> Install &amp; Manage Pythons</h2>
    <p class="desc">uv can install and manage multiple Python versions. Try installing one!</p>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>python-manager</span>
      </div>
      <div class="terminal-body" id="python-out"><span class="dim">Ready to manage some Pythons...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-green" onclick="runPythonList()">&#128203; List Installed</button>
      <button class="btn btn-green" onclick="runPythonInstall('3.12')">Install 3.12</button>
      <button class="btn btn-green" onclick="runPythonInstall('3.11')">Install 3.11</button>
      <button class="btn btn-green" onclick="runPythonInstall('3.10')">Install 3.10</button>
    </div>
  </div>

  <!-- 4. Tool Installer -->
  <div class="card blue">
    <h2><span class="icon">&#128295;</span> Tool Installer</h2>
    <p class="desc">Install popular Python CLI tools with <code>uv tool install</code>. Each tool gets its own isolated environment!</p>
    <div class="tool-grid" id="tool-grid"></div>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>tool-installer</span>
      </div>
      <div class="terminal-body" id="tools-out"><span class="dim">Pick a tool above to get started...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-blue" onclick="listInstalledTools()">&#128203; List Installed Tools</button>
      <button class="btn btn-outline" onclick="showToolPaths()">&#128193; Show Tool Paths</button>
    </div>
  </div>

  <!-- 5. Venv Playground -->
  <div class="card orange">
    <h2><span class="icon">&#127912;</span> Virtual Environment Playground</h2>
    <p class="desc">Create a virtual environment, install packages, and peek at the filesystem!</p>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>venv-playground</span>
      </div>
      <div class="terminal-body" id="venv-out"><span class="dim">Let's build a virtual environment...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-orange" onclick="createVenv()">&#127793; Create Venv</button>
      <button class="btn btn-orange" onclick="venvInstall('requests')">Install requests</button>
      <button class="btn btn-orange" onclick="venvInstall('flask')">Install flask</button>
      <button class="btn btn-orange" onclick="peekVenv()">&#128065; Peek Inside</button>
      <button class="btn btn-red" onclick="destroyVenv()">&#128465; Destroy Venv</button>
    </div>
  </div>

  <!-- 6. Script Runner -->
  <div class="card red">
    <h2><span class="icon">&#127937;</span> Quick Script Runner</h2>
    <p class="desc">Use <code>uv run</code> to execute Python in an ephemeral environment &mdash; no setup needed!</p>
    <div class="terminal">
      <div class="terminal-bar">
        <div class="terminal-dot r"></div><div class="terminal-dot y"></div><div class="terminal-dot g"></div>
        <span>script-runner</span>
      </div>
      <div class="terminal-body" id="script-out"><span class="dim">Pick a fun script to run...</span></div>
    </div>
    <div class="btn-row">
      <button class="btn btn-red" onclick="runScript('hello')">&#128075; Hello World</button>
      <button class="btn btn-red" onclick="runScript('sysinfo')">&#128187; System Info</button>
      <button class="btn btn-red" onclick="runScript('fibonacci')">&#129518; Fibonacci</button>
      <button class="btn btn-red" onclick="runScript('joke')">&#129315; Random Joke</button>
    </div>
  </div>

  <!-- 7. Score -->
  <div class="card purple">
    <h2><span class="icon">&#127942;</span> Your UV Score</h2>
    <p class="desc">Complete each section to fill the bar and earn your UV Master badge!</p>
    <div class="progress-wrap">
      <div class="progress-bar" id="progress-bar" style="width:0%">0%</div>
    </div>
    <div class="score-display">
      <div class="score-num" id="score-num">0 / 6</div>
      <div class="score-label">sections completed</div>
    </div>
    <div id="badges-row" style="display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;justify-content:center;"></div>
  </div>

</div>

<div class="toast" id="toast"></div>

<script>
// ─── State ──────────────────────────────────────
const completed = new Set();
const TOTAL = 6;
const HOME = '/home/user';
let venvCreated = false;
let venvPkgs = [];

const TOOLS = [
  { id:'ruff',     name:'Ruff',     icon:'\u26A1',    desc:'Lightning-fast linter',  installed:false, ver:'0.8.6' },
  { id:'black',    name:'Black',    icon:'\u2B1B',    desc:'Code formatter',          installed:false, ver:'24.10.0' },
  { id:'httpie',   name:'HTTPie',   icon:'\uD83C\uDF10', desc:'Friendly HTTP client', installed:false, ver:'3.2.4' },
  { id:'cowsay',   name:'Cowsay',   icon:'\uD83D\uDC2E', desc:'ASCII art fun',       installed:false, ver:'6.1' },
  { id:'ruff-lsp', name:'Ruff LSP', icon:'\uD83D\uDD0C', desc:'Editor integration',  installed:false, ver:'0.0.62' },
  { id:'pyright',  name:'Pyright',  icon:'\uD83D\uDD0D', desc:'Type checker',        installed:false, ver:'1.1.391' },
];

// ─── Helpers ────────────────────────────────────
const $ = id => document.getElementById(id);
const esc = s => s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;');
const wait = ms => new Promise(r => setTimeout(r, ms));
const rand = (a,b) => Math.floor(Math.random()*(b-a+1))+a;

function setTerm(id, html) {
  const el = $(id);
  el.innerHTML = html;
  el.scrollTop = el.scrollHeight;
}

function prompt(cmd) {
  return `<span class="prompt">$ </span><span class="cmd">${esc(cmd)}</span>\n`;
}

function spin() {
  return `<span class="dim"><span class="spinner"></span> Running...</span>\n`;
}

function toast(msg) {
  const t = $('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2400);
}

function markDone(key) {
  if (completed.has(key)) return;
  completed.add(key);
  updateScore();
  toast('\u2705 Section complete: ' + key);
  if (completed.size === TOTAL) {
    setTimeout(() => { launchConfetti(); toast('\uD83C\uDF89 ALL DONE! You are a UV Master!'); }, 600);
  }
}

function updateScore() {
  const pct = Math.round((completed.size / TOTAL) * 100);
  $('progress-bar').style.width = pct + '%';
  $('progress-bar').textContent = pct + '%';
  $('score-num').textContent = completed.size + ' / ' + TOTAL;

  const row = $('badges-row');
  row.innerHTML = '';
  const names = ['Health Check','System Info','Python Manager','Tool Installer','Venv Playground','Script Runner'];
  const keys  = ['health','sysinfo','python','tools','venv','script'];
  keys.forEach((k, i) => {
    const done = completed.has(k);
    const b = document.createElement('span');
    b.className = 'badge ' + (done ? 'badge-success' : 'badge-info');
    b.textContent = (done ? '\u2705 ' : '\u2B1C ') + names[i];
    row.appendChild(b);
  });
}

// Typewriter effect: writes lines one at a time into a terminal
async function typeLines(termId, lines, baseDelay) {
  const el = $(termId);
  for (const line of lines) {
    el.innerHTML += line + '\n';
    el.scrollTop = el.scrollHeight;
    await wait(baseDelay + rand(30, 120));
  }
}

// ─── 1. Health Check ────────────────────────────
async function runHealthCheck() {
  const id = 'health-out';
  setTerm(id, prompt('uv --version') + spin());
  await wait(rand(600, 1000));

  const ver = '0.5.' + rand(10,30);
  let h = prompt('uv --version');
  h += `<span class="ok">\u2705 uv ${ver} (Homebrew 2025-01-15)</span>\n\n`;
  setTerm(id, h + spin());
  await wait(rand(300, 600));

  h += prompt('which uv');
  h += `<span class="path">${HOME}/.cargo/bin/uv</span>\n\n`;
  setTerm(id, h + spin());
  await wait(rand(200, 400));

  h += prompt('uv self version');
  h += `<span class="out">uv ${ver}\n`;
  h += `commit:  a1b2c3d\n`;
  h += `date:    2025-01-15\n`;
  h += `host:    x86_64-unknown-linux-gnu\n`;
  h += `rust:    1.83.0</span>\n\n`;
  h += `<span class="ok">\uD83C\uDF89 uv is installed and ready to go!</span>\n`;
  setTerm(id, h);
  markDone('health');
}

// ─── 2. System Info ─────────────────────────────
async function runSysInfo() {
  const id = 'sysinfo-out';
  setTerm(id, '');

  const steps = [
    { cmd: 'uv version', out: `<span class="out">uv 0.5.${rand(10,30)} (7b55e9dd3 2025-01-10)</span>` },
    { cmd: 'uv python find', out: `<span class="path">${HOME}/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3</span>` },
    { cmd: 'uname -a', out: `<span class="out">Linux playground 6.1.0-27-amd64 #1 SMP x86_64 GNU/Linux</span>` },
    { cmd: 'uv cache dir', out: `<span class="path">${HOME}/.cache/uv</span>` },
    { cmd: 'du -sh ~/.cache/uv', out: `<span class="out">247M\t${HOME}/.cache/uv</span>` },
  ];

  let h = '';
  for (const s of steps) {
    h += prompt(s.cmd);
    setTerm(id, h + spin());
    await wait(rand(400, 900));
    h += s.out + '\n\n';
    setTerm(id, h);
  }
  h += `<span class="ok">\u2705 System info gathered!</span>\n`;
  setTerm(id, h);
  markDone('sysinfo');
}

// ─── 3. Python Manager ─────────────────────────
const pythonInstalled = {};

async function runPythonList() {
  const id = 'python-out';
  setTerm(id, prompt('uv python list') + spin());
  await wait(rand(500, 1000));

  const all = [
    { ver:'3.13.1', status:'download', path:'' },
    { ver:'3.12.8', status:'installed', path:`${HOME}/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3.12` },
    { ver:'3.11.11', status: pythonInstalled['3.11'] ? 'installed' : 'download', path: pythonInstalled['3.11'] ? `${HOME}/.local/share/uv/python/cpython-3.11.11-linux-x86_64-gnu/bin/python3.11` : '' },
    { ver:'3.10.16', status: pythonInstalled['3.10'] ? 'installed' : 'download', path: pythonInstalled['3.10'] ? `${HOME}/.local/share/uv/python/cpython-3.10.16-linux-x86_64-gnu/bin/python3.10` : '' },
    { ver:'3.9.21',  status:'download', path:'' },
  ];

  let h = prompt('uv python list');
  for (const p of all) {
    if (p.status === 'installed') {
      h += `<span class="ok">  cpython-${p.ver}  \u2705 installed</span>  <span class="path">${p.path}</span>\n`;
    } else {
      h += `<span class="dim">  cpython-${p.ver}     \u2B07\uFE0F  available for download</span>\n`;
    }
  }
  setTerm(id, h);
  markDone('python');
}

async function runPythonInstall(ver) {
  const id = 'python-out';
  const cmd = `uv python install ${ver}`;
  setTerm(id, prompt(cmd) + spin());

  if (pythonInstalled[ver]) {
    await wait(rand(300, 500));
    let h = prompt(cmd);
    h += `<span class="info">\u2139\uFE0F  Python ${ver} is already installed!</span>\n`;
    const fullVer = ver === '3.12' ? '3.12.8' : ver === '3.11' ? '3.11.11' : '3.10.16';
    h += prompt(`uv python find ${ver}`);
    h += `<span class="path">${HOME}/.local/share/uv/python/cpython-${fullVer}-linux-x86_64-gnu/bin/python${ver}</span>\n`;
    setTerm(id, h);
    return;
  }

  const fullVer = ver === '3.12' ? '3.12.8' : ver === '3.11' ? '3.11.11' : '3.10.16';
  const sizeMb = rand(18, 28);

  // Simulated progress
  let h = prompt(cmd);
  const stages = [
    `<span class="info">Searching for Python ${ver}...</span>`,
    `<span class="out">Found cpython-${fullVer}-linux-x86_64-gnu</span>`,
    `<span class="out">Downloading...  [${'='.repeat(0)}${' '.repeat(30)}]  0%</span>`,
  ];
  for (const s of stages) {
    h += s + '\n';
    setTerm(id, h);
    await wait(rand(300, 600));
  }

  // Animate download bar
  for (let pct = 0; pct <= 100; pct += rand(8, 20)) {
    const filled = Math.round(pct / 100 * 30);
    const last = h.lastIndexOf('<span class="out">Downloading');
    const before = h.substring(0, last);
    h = before + `<span class="out">Downloading...  [${'='.repeat(Math.min(filled,30))}${' '.repeat(Math.max(30-filled,0))}]  ${Math.min(pct,100)}%</span>\n`;
    setTerm(id, h);
    await wait(rand(80, 200));
  }
  // finalize at 100
  const last = h.lastIndexOf('<span class="out">Downloading');
  h = h.substring(0, last) + `<span class="out">Downloading...  [${'='.repeat(30)}]  100%  (${sizeMb}.${rand(0,9)}MB)</span>\n`;
  setTerm(id, h);
  await wait(rand(200, 400));

  h += `<span class="out">Unpacking cpython-${fullVer}...</span>\n`;
  setTerm(id, h);
  await wait(rand(400, 800));

  h += `<span class="ok">\u2705 Installed Python ${fullVer}!</span>\n\n`;
  pythonInstalled[ver] = true;

  h += prompt(`uv python find ${ver}`);
  h += `<span class="path">${HOME}/.local/share/uv/python/cpython-${fullVer}-linux-x86_64-gnu/bin/python${ver}</span>\n`;
  setTerm(id, h);
  markDone('python');
}

// ─── 4. Tool Installer ─────────────────────────
function renderToolGrid() {
  const grid = $('tool-grid');
  grid.innerHTML = '';
  TOOLS.forEach(t => {
    const d = document.createElement('div');
    d.className = 'tool-card';
    d.innerHTML = `
      <div class="tool-icon">${t.icon}</div>
      <div class="tool-name">${t.name}</div>
      <div class="tool-desc">${t.desc}</div>
      <div class="tool-status">${t.installed
        ? '<span style="color:var(--green-dark)">\u2705 installed</span>'
        : '<span style="color:#9ca3af">\u2B1C not installed</span>'}</div>
      <div style="margin-top:8px;display:flex;gap:6px;justify-content:center">
        <button class="btn ${t.installed ? 'btn-outline' : 'btn-purple'}" style="padding:6px 14px;font-size:0.8rem"
          onclick="installTool('${t.id}')">${t.installed ? 'Reinstall' : 'Install'}</button>
        ${t.installed ? `<button class="btn btn-red" style="padding:6px 14px;font-size:0.8rem"
          onclick="uninstallTool('${t.id}')">Uninstall</button>` : ''}
      </div>`;
    grid.appendChild(d);
  });
}

async function installTool(id) {
  const tool = TOOLS.find(t => t.id === id);
  const out = 'tools-out';
  const cmd = `uv tool install ${id}`;
  setTerm(out, prompt(cmd) + spin());
  await wait(rand(500, 900));

  let h = prompt(cmd);
  if (tool.installed) {
    h += `<span class="info">\u2139\uFE0F  ${tool.name} is already installed (v${tool.ver})</span>\n`;
    h += `<span class="out">Use --force to reinstall</span>\n`;
    setTerm(out, h);
    return;
  }

  h += `<span class="out">Resolved 1 package in ${rand(50,300)}ms</span>\n`;
  setTerm(out, h);
  await wait(rand(300, 600));

  h += `<span class="out">Installed ${id} v${tool.ver}</span>\n`;
  setTerm(out, h);
  await wait(rand(200, 400));

  h += `<span class="out"> + ${id}==${tool.ver}</span>\n`;
  h += `<span class="ok">\u2705 Installed 1 executable: ${id}</span>\n\n`;

  h += prompt(`which ${id}`);
  h += `<span class="path">${HOME}/.local/bin/${id}</span>\n`;

  tool.installed = true;
  renderToolGrid();
  setTerm(out, h);
  markDone('tools');
}

async function uninstallTool(id) {
  const tool = TOOLS.find(t => t.id === id);
  const out = 'tools-out';
  const cmd = `uv tool uninstall ${id}`;
  setTerm(out, prompt(cmd) + spin());
  await wait(rand(400, 700));

  let h = prompt(cmd);
  h += `<span class="out">Uninstalled ${id} v${tool.ver}</span>\n`;
  h += `<span class="ok">\uD83D\uDDD1\uFE0F  Removed executable: ${id}</span>\n`;

  tool.installed = false;
  renderToolGrid();
  setTerm(out, h);
}

async function listInstalledTools() {
  const out = 'tools-out';
  setTerm(out, prompt('uv tool list') + spin());
  await wait(rand(300, 600));

  let h = prompt('uv tool list');
  const inst = TOOLS.filter(t => t.installed);
  if (inst.length === 0) {
    h += `<span class="dim">No tools installed.</span>\n`;
    h += `<span class="info">Try installing one from the grid above!</span>\n`;
  } else {
    inst.forEach(t => {
      h += `<span class="out">${t.id} v${t.ver}</span>\n`;
      h += `<span class="dim">  - ${t.id}</span>\n`;
    });
    h += `\n<span class="ok">${inst.length} tool(s) installed</span>\n`;
  }
  setTerm(out, h);
  markDone('tools');
}

async function showToolPaths() {
  const out = 'tools-out';
  setTerm(out, '');
  let h = '';

  h += prompt('uv tool dir');
  setTerm(out, h + spin());
  await wait(rand(200, 500));
  h += `<span class="path">${HOME}/.local/share/uv/tools</span>\n\n`;
  setTerm(out, h);

  h += prompt('uv tool dir --bin');
  setTerm(out, h + spin());
  await wait(rand(200, 400));
  h += `<span class="path">${HOME}/.local/bin</span>\n\n`;
  setTerm(out, h);

  h += prompt('ls ~/.local/share/uv/tools/');
  setTerm(out, h + spin());
  await wait(rand(300, 600));

  const inst = TOOLS.filter(t => t.installed);
  if (inst.length === 0) {
    h += `<span class="dim">(empty &mdash; no tools installed yet)</span>\n`;
  } else {
    inst.forEach(t => {
      h += `<span class="info">\uD83D\uDCC2 ${t.id}/</span>\n`;
      h += `<span class="dim">   \u2514\u2500 bin/\n       \u2514\u2500 ${t.id}</span>\n`;
      h += `<span class="dim">   \u2514\u2500 lib/python3.12/site-packages/${t.id}/</span>\n`;
    });
  }
  setTerm(out, h);
  markDone('tools');
}

// ─── 5. Venv Playground ────────────────────────
async function createVenv() {
  const id = 'venv-out';
  const dir = '~/my-project/.venv';
  setTerm(id, prompt(`uv venv ${dir}`) + spin());
  await wait(rand(500, 900));

  let h = prompt(`uv venv ${dir}`);
  if (venvCreated) {
    h += `<span class="info">\u2139\uFE0F  Virtual environment already exists at ${dir}</span>\n`;
    setTerm(id, h);
    return;
  }

  h += `<span class="out">Using CPython 3.12.8 interpreter at:\n  ${HOME}/.local/share/uv/python/cpython-3.12.8-linux-x86_64-gnu/bin/python3.12</span>\n`;
  setTerm(id, h);
  await wait(rand(300, 500));

  h += `<span class="out">Creating virtual environment at: ${dir}</span>\n`;
  setTerm(id, h);
  await wait(rand(300, 500));

  h += `<span class="ok">\u2705 Created virtual environment in ${rand(8,25)}ms</span>\n`;
  h += `<span class="out">  Activate with: <span class="info">source ${dir}/bin/activate</span></span>\n\n`;
  h += `<span class="info">\uD83D\uDCC1 Venv location: </span><span class="path">${HOME}/my-project/.venv</span>\n`;

  venvCreated = true;
  venvPkgs = [];
  setTerm(id, h);
  markDone('venv');
}

const PKG_DATA = {
  requests: { ver:'2.32.3', deps:['certifi==2024.12.14','charset-normalizer==3.4.1','idna==3.10','urllib3==2.3.0'], size:'1.2MB' },
  flask:    { ver:'3.1.0',  deps:['Werkzeug==3.1.3','Jinja2==3.1.5','MarkupSafe==3.0.2','itsdangerous==2.2.0','click==8.1.8','blinker==1.9.0'], size:'2.8MB' },
};

async function venvInstall(pkg) {
  const id = 'venv-out';
  if (!venvCreated) {
    setTerm(id, `<span class="err">\u26A0\uFE0F Create a venv first!</span>\n`);
    return;
  }
  if (venvPkgs.includes(pkg)) {
    setTerm(id, prompt(`uv pip install ${pkg}`) + `<span class="info">\u2139\uFE0F  ${pkg} is already installed in the venv</span>\n`);
    return;
  }

  const data = PKG_DATA[pkg];
  const cmd = `uv pip install ${pkg}`;
  setTerm(id, prompt(cmd) + spin());
  await wait(rand(400, 700));

  let h = prompt(cmd);
  h += `<span class="out">Resolved ${data.deps.length + 1} packages in ${rand(80,400)}ms</span>\n`;
  setTerm(id, h);
  await wait(rand(300, 500));

  h += `<span class="out">Downloading...</span>\n`;
  setTerm(id, h);
  await wait(rand(400, 800));

  h += `<span class="out">Downloaded ${data.deps.length + 1} packages (${data.size})</span>\n`;
  setTerm(id, h);
  await wait(rand(200, 400));

  h += `<span class="out">Installed ${data.deps.length + 1} packages in ${rand(30,120)}ms</span>\n`;
  data.deps.forEach(d => { h += `<span class="dim"> + ${d}</span>\n`; });
  h += `<span class="ok"> + ${pkg}==${data.ver}</span>\n`;
  h += `\n<span class="ok">\u2705 Successfully installed ${pkg}!</span>\n`;

  venvPkgs.push(pkg);
  setTerm(id, h);
  markDone('venv');
}

async function peekVenv() {
  const id = 'venv-out';
  if (!venvCreated) {
    setTerm(id, `<span class="err">\u26A0\uFE0F Create a venv first!</span>\n`);
    return;
  }

  setTerm(id, spin());
  await wait(rand(300, 600));

  let h = prompt('ls -la ~/my-project/.venv/');
  const tree = [
    '<span class="info">\uD83D\uDCC2 bin/</span>',
    '<span class="dim">   \u251C\u2500 activate</span>',
    '<span class="dim">   \u251C\u2500 activate.fish</span>',
    '<span class="dim">   \u251C\u2500 python \u2192 python3.12</span>',
    '<span class="dim">   \u2514\u2500 python3.12</span>',
    '<span class="info">\uD83D\uDCC2 lib/</span>',
    '<span class="dim">   \u2514\u2500 python3.12/</span>',
    '<span class="dim">       \u2514\u2500 site-packages/</span>',
  ];

  venvPkgs.forEach(p => {
    tree.push(`<span class="ok">           \u251C\u2500 ${p}/</span>`);
    PKG_DATA[p].deps.forEach(d => {
      const name = d.split('==')[0].toLowerCase().replace(/-/g,'_');
      tree.push(`<span class="dim">           \u251C\u2500 ${name}/</span>`);
    });
  });

  tree.push('<span class="info">\uD83D\uDCC4 pyvenv.cfg</span>');

  for (const line of tree) {
    h += line + '\n';
    setTerm(id, h);
    await wait(rand(40, 100));
  }

  if (venvPkgs.length > 0) {
    h += '\n' + prompt('uv pip list');
    h += '<span class="out">Package            Version</span>\n';
    h += '<span class="out">------------------ --------</span>\n';
    venvPkgs.forEach(p => {
      h += `<span class="ok">${p.padEnd(19)}${PKG_DATA[p].ver}</span>\n`;
      PKG_DATA[p].deps.forEach(d => {
        const [n,v] = d.split('==');
        h += `<span class="dim">${n.padEnd(19)}${v}</span>\n`;
      });
    });
  }

  setTerm(id, h);
  markDone('venv');
}

async function destroyVenv() {
  const id = 'venv-out';
  if (!venvCreated) {
    setTerm(id, `<span class="dim">No venv to destroy. Create one first!</span>\n`);
    return;
  }
  setTerm(id, prompt('rm -rf ~/my-project/.venv') + spin());
  await wait(rand(300, 600));

  let h = prompt('rm -rf ~/my-project/.venv');
  h += `<span class="ok">\uD83D\uDDD1\uFE0F  Venv destroyed! All packages removed.</span>\n`;
  h += `<span class="dim">You can create a fresh one anytime.</span>\n`;
  venvCreated = false;
  venvPkgs = [];
  setTerm(id, h);
}

// ─── 6. Script Runner ──────────────────────────
const SCRIPTS = {
  hello: {
    cmd: 'uv run python -c "print(\'Hello from UV!\')"',
    lines: [
      '<span class="ok">\u2728 Hello from UV! \u2728</span>',
      '',
      '<span class="out">Python is working perfectly.</span>',
      '<span class="out">uv made it effortless!</span>',
      '<span class="out">No venv. No pip. Just vibes. \uD83C\uDF1F</span>',
    ],
  },
  sysinfo: {
    cmd: 'uv run python -c "import sys, platform; ..."',
    lines: () => [
      '<span class="info">\uD83D\uDCBB System Info via uv run</span>',
      `<span class="out">  Python:   3.12.8 (main, Dec  3 2025, 18:34:01) [GCC 12.2.0]</span>`,
      `<span class="out">  Platform: Linux-6.1.0-27-amd64-x86_64</span>`,
      `<span class="out">  Arch:     x86_64</span>`,
      `<span class="out">  CWD:      ${HOME}/my-project</span>`,
      `<span class="out">  PID:      ${rand(1000,65000)}</span>`,
      `<span class="out">  Time:     ${new Date().toLocaleTimeString()}</span>`,
    ],
  },
  fibonacci: {
    cmd: 'uv run python -c "# fibonacci art"',
    lines: () => {
      const lines = ['<span class="info">\uD83E\uDDEE Fibonacci sequence (first 15):</span>'];
      let a = 0, b = 1;
      for (let i = 0; i < 15; i++) {
        const bar = '\u2588'.repeat(Math.min(a % 40 + 1, 40));
        const idx = String(i).padStart(2);
        const val = String(a).padStart(4);
        lines.push(`<span class="out">  F(${idx}) = ${val}  </span><span class="ok">${bar}</span>`);
        [a, b] = [b, a + b];
      }
      return lines;
    },
  },
  joke: {
    cmd: 'uv run python -c "import random; ..."',
    lines: () => {
      const jokes = [
        ['\uD83E\uDD23 Why do Python programmers prefer dark mode?', '   ... Because light attracts bugs! \uD83D\uDC1B'],
        ['\uD83E\uDD23 Why did the developer quit?', '   ... Because they didn\'t get arrays! \uD83D\uDCB0'],
        ['\uD83E\uDD23 How do you comfort a JavaScript dev?', '   ... You console.log them! \uD83D\uDDA5'],
        ['\uD83E\uDD23 Why do Java devs wear glasses?', '   ... Because they can\'t C#! \uD83D\uDC53'],
        ['\uD83E\uDD23 What\u2019s a Python dev\u2019s fav movie?', '   ... The Matrix... all the imports! \uD83C\uDFAC'],
        ['\uD83E\uDD23 How many programmers to change a bulb?', '   ... None. That\u2019s a hardware problem! \uD83D\uDCA1'],
        ['\uD83E\uDD23 Why did the Python data class break up?', '   ... Too many fields, not enough methods! \uD83D\uDC94'],
      ];
      const [q, a] = jokes[Math.floor(Math.random() * jokes.length)];
      return [
        `<span class="out">${q}</span>`,
        `<span class="ok">${a}</span>`,
      ];
    },
  },
};

async function runScript(key) {
  const id = 'script-out';
  const s = SCRIPTS[key];
  setTerm(id, prompt(s.cmd) + spin());
  await wait(rand(600, 1200));

  let h = prompt(s.cmd);
  setTerm(id, h);

  const lines = typeof s.lines === 'function' ? s.lines() : s.lines;
  for (const line of lines) {
    h += line + '\n';
    setTerm(id, h);
    await wait(rand(50, 150));
  }
  h += '\n<span class="dim">Process exited with code 0  \u2705</span>\n';
  setTerm(id, h);
  markDone('script');
}

// ─── Confetti ───────────────────────────────────
function launchConfetti() {
  const canvas = $('confetti-canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const pieces = [];
  const colors = ['#7c3aed','#ec4899','#fbbf24','#34d399','#60a5fa','#fb923c','#f87171'];

  for (let i = 0; i < 180; i++) {
    pieces.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height - canvas.height,
      w: Math.random() * 10 + 5,
      h: Math.random() * 6 + 3,
      color: colors[Math.floor(Math.random() * colors.length)],
      vy: Math.random() * 3 + 2,
      vx: (Math.random() - 0.5) * 2,
      rot: Math.random() * 360,
      rv: (Math.random() - 0.5) * 8,
    });
  }

  let frame = 0;
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    pieces.forEach(p => {
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate((p.rot * Math.PI) / 180);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
      ctx.restore();
      p.y += p.vy;
      p.x += p.vx;
      p.rot += p.rv;
    });
    frame++;
    if (frame < 200) requestAnimationFrame(draw);
    else ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  draw();
}

// ─── Init ───────────────────────────────────────
renderToolGrid();
updateScore();
</script>
</body>
</html>
